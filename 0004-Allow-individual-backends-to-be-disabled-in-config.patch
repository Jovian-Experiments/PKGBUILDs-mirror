From e4a63b93725cd55996019151b5eb749615c1cfe2 Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Thu, 9 May 2024 18:10:09 -0700
Subject: [PATCH] Allow individual backends to be disabled in config

---
 src/main.cpp | 18 ++++++++++++++----
 1 file changed, 14 insertions(+), 4 deletions(-)

diff --git a/src/main.cpp b/src/main.cpp
index 25a9f0e..6551877 100644
--- a/src/main.cpp
+++ b/src/main.cpp
@@ -18,7 +18,9 @@
 #include <QCommandLineParser>
 #include <QDebug>
 #include <QDBusConnection>
+#include <KConfigGroup>
 #include <KLocalizedString>
+#include <KSharedConfig>
 
 #include <KAboutData>
 #include <KDBusService>
@@ -58,14 +60,22 @@ int main(int argc, char *argv[])
 
     KDBusService service(KDBusService::Unique | startup);
 
-    new EvdevController();
+    KSharedConfigPtr config = KSharedConfig::openConfig();
+    KConfigGroup generalGroup = config->group("General");
+    if (generalGroup.readEntry("EnableEvdev", true)) {
+        new EvdevController();
+    }
 
 #ifdef HAS_LIBCEC
-    new CECController();
+    if (generalGroup.readEntry("EnableCEC", true)) {
+        new CECController();
+    }
 #endif
-    
+
 #ifdef HAS_XWIIMOTE
-    new WiimoteController();
+    if (generalGroup.readEntry("EnableWiimote", true)) {
+        new WiimoteController();
+    }
 #endif // HAS_XWIIMOTE
 
     if (!QDBusConnection::sessionBus().isConnected()) {
-- 
2.44.0

