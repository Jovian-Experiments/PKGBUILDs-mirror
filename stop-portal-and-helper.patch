From: Alberto Garcia <berto@igalia.com>
Subject: Stop flatpak-session-helper and flatpak-portal when the session ends
Origin: https://github.com/flatpak/flatpak/commit/8b399219338663f2c49205f3614684fd2c16aec0
Bug: https://github.com/flatpak/flatpak/issues/5068
diff --git a/portal/flatpak-portal.service.in b/portal/flatpak-portal.service.in
index a19431fa15..b7a35a887c 100644
--- a/portal/flatpak-portal.service.in
+++ b/portal/flatpak-portal.service.in
@@ -1,5 +1,6 @@
 [Unit]
 Description=flatpak portal
+PartOf=graphical-session.target
 
 [Service]
 BusName=org.freedesktop.portal.Flatpak
diff --git a/session-helper/flatpak-session-helper.service.in b/session-helper/flatpak-session-helper.service.in
index e14cc27d1f..4da0dd9cfc 100644
--- a/session-helper/flatpak-session-helper.service.in
+++ b/session-helper/flatpak-session-helper.service.in
@@ -1,5 +1,6 @@
 [Unit]
 Description=flatpak session helper
+PartOf=graphical-session.target
 
 [Service]
 BusName=org.freedesktop.Flatpak
