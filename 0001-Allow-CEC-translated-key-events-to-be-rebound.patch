From 1d915962889f80fa934bd3cf2dc47b5ae615e24b Mon Sep 17 00:00:00 2001
From: Vicki Pfau <vi@endrift.com>
Date: Tue, 31 Jan 2023 18:15:02 -0800
Subject: [PATCH] Allow CEC translated key events to be rebound

---
 src/libcec/ceccontroller.cpp | 66 +++++++++++++++++++-----------------
 1 file changed, 35 insertions(+), 31 deletions(-)

diff --git a/src/libcec/ceccontroller.cpp b/src/libcec/ceccontroller.cpp
index 812c969..3e54244 100644
--- a/src/libcec/ceccontroller.cpp
+++ b/src/libcec/ceccontroller.cpp
@@ -92,38 +92,42 @@ CECController::CECController()
     KSharedConfigPtr config = KSharedConfig::openConfig();
     KConfigGroup generalGroup = config->group("General");
 
+    auto configPair = [&generalGroup](const char* name, int cecKey, int evKey) {
+        return std::make_pair<int, int>(generalGroup.readEntry(QString("Button") + name, cecKey), generalGroup.readEntry(QString("Key") + name, evKey));
+    };
+
     m_keyCodeTranslation = {
-        { generalGroup.readEntry("ButtonPlay", (int) CEC_USER_CONTROL_CODE_PLAY), KEY_PLAY},
-        { generalGroup.readEntry("ButtonStop", (int) CEC_USER_CONTROL_CODE_STOP), KEY_STOP},
-        { generalGroup.readEntry("ButtonPause", (int) CEC_USER_CONTROL_CODE_PAUSE), KEY_PAUSE},
-        { generalGroup.readEntry("ButtonRewind", (int) CEC_USER_CONTROL_CODE_REWIND), KEY_REWIND},
-        { generalGroup.readEntry("ButtonFastforward", (int) CEC_USER_CONTROL_CODE_FAST_FORWARD), KEY_FASTFORWARD},
-        { generalGroup.readEntry("ButtonEnter", (int) CEC_USER_CONTROL_CODE_SELECT), KEY_ENTER},
-        { generalGroup.readEntry("ButtonUp", (int) CEC_USER_CONTROL_CODE_UP), KEY_UP},
-        { generalGroup.readEntry("ButtonDown", (int) CEC_USER_CONTROL_CODE_DOWN), KEY_DOWN},
-        { generalGroup.readEntry("ButtonLeft", (int) CEC_USER_CONTROL_CODE_LEFT), KEY_LEFT},
-        { generalGroup.readEntry("ButtonRight", (int) CEC_USER_CONTROL_CODE_RIGHT), KEY_RIGHT},
-        { generalGroup.readEntry("ButtonNumber0", (int) CEC_USER_CONTROL_CODE_NUMBER0), KEY_0},
-        { generalGroup.readEntry("ButtonNumber1", (int) CEC_USER_CONTROL_CODE_NUMBER1), KEY_1},
-        { generalGroup.readEntry("ButtonNumber2", (int) CEC_USER_CONTROL_CODE_NUMBER2), KEY_2},
-        { generalGroup.readEntry("ButtonNumber3", (int) CEC_USER_CONTROL_CODE_NUMBER3), KEY_3},
-        { generalGroup.readEntry("ButtonNumber4", (int) CEC_USER_CONTROL_CODE_NUMBER4), KEY_4},
-        { generalGroup.readEntry("ButtonNumber5", (int) CEC_USER_CONTROL_CODE_NUMBER5), KEY_5},
-        { generalGroup.readEntry("ButtonNumber6", (int) CEC_USER_CONTROL_CODE_NUMBER6), KEY_6},
-        { generalGroup.readEntry("ButtonNumber7", (int) CEC_USER_CONTROL_CODE_NUMBER7), KEY_7},
-        { generalGroup.readEntry("ButtonNumber8", (int) CEC_USER_CONTROL_CODE_NUMBER8), KEY_8},
-        { generalGroup.readEntry("ButtonNumber9", (int) CEC_USER_CONTROL_CODE_NUMBER9), KEY_9},
-        { generalGroup.readEntry("ButtonBlue", (int) CEC_USER_CONTROL_CODE_F1_BLUE), KEY_BLUE},
-        { generalGroup.readEntry("ButtonRed", (int) CEC_USER_CONTROL_CODE_F2_RED), KEY_RED},
-        { generalGroup.readEntry("ButtonGreen", (int) CEC_USER_CONTROL_CODE_F3_GREEN), KEY_GREEN},
-        { generalGroup.readEntry("ButtonYellow", (int) CEC_USER_CONTROL_CODE_F4_YELLOW), KEY_YELLOW},
-        { generalGroup.readEntry("ButtonChannelUp", (int) CEC_USER_CONTROL_CODE_CHANNEL_UP), KEY_CHANNELUP},
-        { generalGroup.readEntry("ButtonChannelDown", (int) CEC_USER_CONTROL_CODE_CHANNEL_DOWN), KEY_CHANNELDOWN},
-        { generalGroup.readEntry("ButtonExit", (int) CEC_USER_CONTROL_CODE_EXIT), KEY_EXIT},
-        { generalGroup.readEntry("ButtonBack", (int) CEC_USER_CONTROL_CODE_AN_RETURN), KEY_BACK},
-        { generalGroup.readEntry("ButtonHome", (int) CEC_USER_CONTROL_CODE_ROOT_MENU), KEY_HOMEPAGE},
-        { generalGroup.readEntry("ButtonSubtitle", (int) CEC_USER_CONTROL_CODE_SUB_PICTURE), KEY_SUBTITLE},
-        { generalGroup.readEntry("ButtonInfo", (int) CEC_USER_CONTROL_CODE_DISPLAY_INFORMATION), KEY_INFO},
+        configPair("Play", CEC_USER_CONTROL_CODE_PLAY, KEY_PLAY),
+        configPair("Stop", CEC_USER_CONTROL_CODE_STOP, KEY_STOP),
+        configPair("Pause", CEC_USER_CONTROL_CODE_PAUSE, KEY_PAUSE),
+        configPair("Rewind", CEC_USER_CONTROL_CODE_REWIND, KEY_REWIND),
+        configPair("Fastforward", CEC_USER_CONTROL_CODE_FAST_FORWARD, KEY_FASTFORWARD),
+        configPair("Enter", CEC_USER_CONTROL_CODE_SELECT, KEY_ENTER),
+        configPair("Up", CEC_USER_CONTROL_CODE_UP, KEY_UP),
+        configPair("Down", CEC_USER_CONTROL_CODE_DOWN, KEY_DOWN),
+        configPair("Left", CEC_USER_CONTROL_CODE_LEFT, KEY_LEFT),
+        configPair("Right", CEC_USER_CONTROL_CODE_RIGHT, KEY_RIGHT),
+        configPair("Number0", CEC_USER_CONTROL_CODE_NUMBER0, KEY_0),
+        configPair("Number1", CEC_USER_CONTROL_CODE_NUMBER1, KEY_1),
+        configPair("Number2", CEC_USER_CONTROL_CODE_NUMBER2, KEY_2),
+        configPair("Number3", CEC_USER_CONTROL_CODE_NUMBER3, KEY_3),
+        configPair("Number4", CEC_USER_CONTROL_CODE_NUMBER4, KEY_4),
+        configPair("Number5", CEC_USER_CONTROL_CODE_NUMBER5, KEY_5),
+        configPair("Number6", CEC_USER_CONTROL_CODE_NUMBER6, KEY_6),
+        configPair("Number7", CEC_USER_CONTROL_CODE_NUMBER7, KEY_7),
+        configPair("Number8", CEC_USER_CONTROL_CODE_NUMBER8, KEY_8),
+        configPair("Number9", CEC_USER_CONTROL_CODE_NUMBER9, KEY_9),
+        configPair("Blue", CEC_USER_CONTROL_CODE_F1_BLUE, KEY_BLUE),
+        configPair("Red", CEC_USER_CONTROL_CODE_F2_RED, KEY_RED),
+        configPair("Green", CEC_USER_CONTROL_CODE_F3_GREEN, KEY_GREEN),
+        configPair("Yellow", CEC_USER_CONTROL_CODE_F4_YELLOW, KEY_YELLOW),
+        configPair("ChannelUp", CEC_USER_CONTROL_CODE_CHANNEL_UP, KEY_CHANNELUP),
+        configPair("ChannelDown", CEC_USER_CONTROL_CODE_CHANNEL_DOWN, KEY_CHANNELDOWN),
+        configPair("Exit", CEC_USER_CONTROL_CODE_EXIT, KEY_EXIT),
+        configPair("Back", CEC_USER_CONTROL_CODE_AN_RETURN, KEY_BACK),
+        configPair("Home", CEC_USER_CONTROL_CODE_ROOT_MENU, KEY_HOMEPAGE),
+        configPair("Subtitle", CEC_USER_CONTROL_CODE_SUB_PICTURE, KEY_SUBTITLE),
+        configPair("Info", CEC_USER_CONTROL_CODE_DISPLAY_INFORMATION, KEY_INFO),
     };
 
     m_cecCallbacks.Clear();
-- 
2.44.0

