# Maintainer: Jeremy Whiting <jeremy.whiting@collabora.com>

pkgname=steamos-manager
_srctag=v24.5.1
pkgver=${_srctag##v}
pkgrel=2
pkgdesc='SteamOS Manager daemon for running various tasks as root'
arch=('x86_64')
url='https://store.steampowered.com/steamos/'
license=('LGPL2.1')
depends=('dbus'
         'steamos-networking-tools'  # For steamos-wifi-set-backend
         'systemd'
         'wireless_tools')  # For iwconfig
optdepends=('steamos-customizations-jupiter: jupiter support'  # Needed for steamos-factory-reset-config
            'jupiter-hw-support: jupiter support'  # Needed for jupiter-get-als-gain, jupiter-biosupdate, steamos-format-device, steamos-trim-devices
            'jupiter-dock-updater-bin: jupiter dock updater'  # Needed for jupiter-dock-updater
            'steamos-log-submitter: ftrace logging')
makedepends=('git' 'cargo' 'holo-rust-packaging-tools')
source=("$pkgname-$pkgver::git+ssh://git@gitlab.steamos.cloud/holo/$pkgname.git#tag=${_srctag}"
        'disable-split-lock-warn.patch'
        'addr2line-0.21.0.tar.gz::https://crates.io/api/v1/crates/addr2line/0.21.0/download'
        'adler-1.0.2.tar.gz::https://crates.io/api/v1/crates/adler/1.0.2/download'
        'anstyle-1.0.7.tar.gz::https://crates.io/api/v1/crates/anstyle/1.0.7/download'
        'anyhow-1.0.83.tar.gz::https://crates.io/api/v1/crates/anyhow/1.0.83/download'
        'async-broadcast-0.7.0.tar.gz::https://crates.io/api/v1/crates/async-broadcast/0.7.0/download'
        'async-channel-2.3.0.tar.gz::https://crates.io/api/v1/crates/async-channel/2.3.0/download'
        'async-io-2.3.2.tar.gz::https://crates.io/api/v1/crates/async-io/2.3.2/download'
        'async-lock-3.3.0.tar.gz::https://crates.io/api/v1/crates/async-lock/3.3.0/download'
        'async-process-2.2.2.tar.gz::https://crates.io/api/v1/crates/async-process/2.2.2/download'
        'async-recursion-1.1.1.tar.gz::https://crates.io/api/v1/crates/async-recursion/1.1.1/download'
        'async-signal-0.2.6.tar.gz::https://crates.io/api/v1/crates/async-signal/0.2.6/download'
        'async-task-4.7.1.tar.gz::https://crates.io/api/v1/crates/async-task/4.7.1/download'
        'async-trait-0.1.80.tar.gz::https://crates.io/api/v1/crates/async-trait/0.1.80/download'
        'atomic-waker-1.1.2.tar.gz::https://crates.io/api/v1/crates/atomic-waker/1.1.2/download'
        'autocfg-1.3.0.tar.gz::https://crates.io/api/v1/crates/autocfg/1.3.0/download'
        'backtrace-0.3.71.tar.gz::https://crates.io/api/v1/crates/backtrace/0.3.71/download'
        'bitflags-1.3.2.tar.gz::https://crates.io/api/v1/crates/bitflags/1.3.2/download'
        'bitflags-2.5.0.tar.gz::https://crates.io/api/v1/crates/bitflags/2.5.0/download'
        'block-buffer-0.10.4.tar.gz::https://crates.io/api/v1/crates/block-buffer/0.10.4/download'
        'blocking-1.6.0.tar.gz::https://crates.io/api/v1/crates/blocking/1.6.0/download'
        'bytes-1.6.0.tar.gz::https://crates.io/api/v1/crates/bytes/1.6.0/download'
        'cc-1.0.97.tar.gz::https://crates.io/api/v1/crates/cc/1.0.97/download'
        'cfg-if-1.0.0.tar.gz::https://crates.io/api/v1/crates/cfg-if/1.0.0/download'
        'cfg_aliases-0.1.1.tar.gz::https://crates.io/api/v1/crates/cfg_aliases/0.1.1/download'
        'clap-4.5.4.tar.gz::https://crates.io/api/v1/crates/clap/4.5.4/download'
        'clap_builder-4.5.2.tar.gz::https://crates.io/api/v1/crates/clap_builder/4.5.2/download'
        'clap_derive-4.5.4.tar.gz::https://crates.io/api/v1/crates/clap_derive/4.5.4/download'
        'clap_lex-0.7.0.tar.gz::https://crates.io/api/v1/crates/clap_lex/0.7.0/download'
        'concurrent-queue-2.5.0.tar.gz::https://crates.io/api/v1/crates/concurrent-queue/2.5.0/download'
        'cpufeatures-0.2.12.tar.gz::https://crates.io/api/v1/crates/cpufeatures/0.2.12/download'
        'crossbeam-utils-0.8.19.tar.gz::https://crates.io/api/v1/crates/crossbeam-utils/0.8.19/download'
        'crypto-common-0.1.6.tar.gz::https://crates.io/api/v1/crates/crypto-common/0.1.6/download'
        'digest-0.10.7.tar.gz::https://crates.io/api/v1/crates/digest/0.10.7/download'
        'either-1.11.0.tar.gz::https://crates.io/api/v1/crates/either/1.11.0/download'
        'endi-1.1.0.tar.gz::https://crates.io/api/v1/crates/endi/1.1.0/download'
        'enumflags2-0.7.9.tar.gz::https://crates.io/api/v1/crates/enumflags2/0.7.9/download'
        'enumflags2_derive-0.7.9.tar.gz::https://crates.io/api/v1/crates/enumflags2_derive/0.7.9/download'
        'equivalent-1.0.1.tar.gz::https://crates.io/api/v1/crates/equivalent/1.0.1/download'
        'errno-0.3.9.tar.gz::https://crates.io/api/v1/crates/errno/0.3.9/download'
        'event-listener-4.0.3.tar.gz::https://crates.io/api/v1/crates/event-listener/4.0.3/download'
        'event-listener-5.3.0.tar.gz::https://crates.io/api/v1/crates/event-listener/5.3.0/download'
        'event-listener-strategy-0.4.0.tar.gz::https://crates.io/api/v1/crates/event-listener-strategy/0.4.0/download'
        'event-listener-strategy-0.5.2.tar.gz::https://crates.io/api/v1/crates/event-listener-strategy/0.5.2/download'
        'fastrand-2.1.0.tar.gz::https://crates.io/api/v1/crates/fastrand/2.1.0/download'
        'futures-core-0.3.30.tar.gz::https://crates.io/api/v1/crates/futures-core/0.3.30/download'
        'futures-io-0.3.30.tar.gz::https://crates.io/api/v1/crates/futures-io/0.3.30/download'
        'futures-lite-2.3.0.tar.gz::https://crates.io/api/v1/crates/futures-lite/2.3.0/download'
        'futures-sink-0.3.30.tar.gz::https://crates.io/api/v1/crates/futures-sink/0.3.30/download'
        'futures-task-0.3.30.tar.gz::https://crates.io/api/v1/crates/futures-task/0.3.30/download'
        'futures-util-0.3.30.tar.gz::https://crates.io/api/v1/crates/futures-util/0.3.30/download'
        'generic-array-0.14.7.tar.gz::https://crates.io/api/v1/crates/generic-array/0.14.7/download'
        'getrandom-0.2.15.tar.gz::https://crates.io/api/v1/crates/getrandom/0.2.15/download'
        'gimli-0.28.1.tar.gz::https://crates.io/api/v1/crates/gimli/0.28.1/download'
        'hashbrown-0.14.5.tar.gz::https://crates.io/api/v1/crates/hashbrown/0.14.5/download'
        'heck-0.5.0.tar.gz::https://crates.io/api/v1/crates/heck/0.5.0/download'
        'hermit-abi-0.3.9.tar.gz::https://crates.io/api/v1/crates/hermit-abi/0.3.9/download'
        'hex-0.4.3.tar.gz::https://crates.io/api/v1/crates/hex/0.4.3/download'
        'indexmap-2.2.6.tar.gz::https://crates.io/api/v1/crates/indexmap/2.2.6/download'
        'inotify-0.10.2.tar.gz::https://crates.io/api/v1/crates/inotify/0.10.2/download'
        'inotify-sys-0.1.5.tar.gz::https://crates.io/api/v1/crates/inotify-sys/0.1.5/download'
        'itertools-0.12.1.tar.gz::https://crates.io/api/v1/crates/itertools/0.12.1/download'
        'lazy_static-1.4.0.tar.gz::https://crates.io/api/v1/crates/lazy_static/1.4.0/download'
        'libc-0.2.154.tar.gz::https://crates.io/api/v1/crates/libc/0.2.154/download'
        'linux-raw-sys-0.4.13.tar.gz::https://crates.io/api/v1/crates/linux-raw-sys/0.4.13/download'
        'memchr-2.7.2.tar.gz::https://crates.io/api/v1/crates/memchr/2.7.2/download'
        'memoffset-0.9.1.tar.gz::https://crates.io/api/v1/crates/memoffset/0.9.1/download'
        'miniz_oxide-0.7.2.tar.gz::https://crates.io/api/v1/crates/miniz_oxide/0.7.2/download'
        'mio-0.8.11.tar.gz::https://crates.io/api/v1/crates/mio/0.8.11/download'
        'nix-0.28.0.tar.gz::https://crates.io/api/v1/crates/nix/0.28.0/download'
        'num_cpus-1.16.0.tar.gz::https://crates.io/api/v1/crates/num_cpus/1.16.0/download'
        'object-0.32.2.tar.gz::https://crates.io/api/v1/crates/object/0.32.2/download'
        'once_cell-1.19.0.tar.gz::https://crates.io/api/v1/crates/once_cell/1.19.0/download'
        'ordered-stream-0.2.0.tar.gz::https://crates.io/api/v1/crates/ordered-stream/0.2.0/download'
        'parking-2.2.0.tar.gz::https://crates.io/api/v1/crates/parking/2.2.0/download'
        'pin-project-lite-0.2.14.tar.gz::https://crates.io/api/v1/crates/pin-project-lite/0.2.14/download'
        'pin-utils-0.1.0.tar.gz::https://crates.io/api/v1/crates/pin-utils/0.1.0/download'
        'piper-0.2.2.tar.gz::https://crates.io/api/v1/crates/piper/0.2.2/download'
        'polling-3.7.0.tar.gz::https://crates.io/api/v1/crates/polling/3.7.0/download'
        'ppv-lite86-0.2.17.tar.gz::https://crates.io/api/v1/crates/ppv-lite86/0.2.17/download'
        'proc-macro-crate-3.1.0.tar.gz::https://crates.io/api/v1/crates/proc-macro-crate/3.1.0/download'
        'proc-macro2-1.0.82.tar.gz::https://crates.io/api/v1/crates/proc-macro2/1.0.82/download'
        'quick-xml-0.30.0.tar.gz::https://crates.io/api/v1/crates/quick-xml/0.30.0/download'
        'quote-1.0.36.tar.gz::https://crates.io/api/v1/crates/quote/1.0.36/download'
        'rand-0.8.5.tar.gz::https://crates.io/api/v1/crates/rand/0.8.5/download'
        'rand_chacha-0.3.1.tar.gz::https://crates.io/api/v1/crates/rand_chacha/0.3.1/download'
        'rand_core-0.6.4.tar.gz::https://crates.io/api/v1/crates/rand_core/0.6.4/download'
        'rustc-demangle-0.1.24.tar.gz::https://crates.io/api/v1/crates/rustc-demangle/0.1.24/download'
        'rustix-0.38.34.tar.gz::https://crates.io/api/v1/crates/rustix/0.38.34/download'
        'serde-1.0.201.tar.gz::https://crates.io/api/v1/crates/serde/1.0.201/download'
        'serde_derive-1.0.201.tar.gz::https://crates.io/api/v1/crates/serde_derive/1.0.201/download'
        'serde_repr-0.1.19.tar.gz::https://crates.io/api/v1/crates/serde_repr/0.1.19/download'
        'sha1-0.10.6.tar.gz::https://crates.io/api/v1/crates/sha1/0.10.6/download'
        'sharded-slab-0.1.7.tar.gz::https://crates.io/api/v1/crates/sharded-slab/0.1.7/download'
        'signal-hook-registry-1.4.2.tar.gz::https://crates.io/api/v1/crates/signal-hook-registry/1.4.2/download'
        'slab-0.4.9.tar.gz::https://crates.io/api/v1/crates/slab/0.4.9/download'
        'socket2-0.5.7.tar.gz::https://crates.io/api/v1/crates/socket2/0.5.7/download'
        'static_assertions-1.1.0.tar.gz::https://crates.io/api/v1/crates/static_assertions/1.1.0/download'
        'syn-1.0.109.tar.gz::https://crates.io/api/v1/crates/syn/1.0.109/download'
        'syn-2.0.63.tar.gz::https://crates.io/api/v1/crates/syn/2.0.63/download'
        'tempfile-3.10.1.tar.gz::https://crates.io/api/v1/crates/tempfile/3.10.1/download'
        'thread_local-1.1.8.tar.gz::https://crates.io/api/v1/crates/thread_local/1.1.8/download'
        'tokio-1.37.0.tar.gz::https://crates.io/api/v1/crates/tokio/1.37.0/download'
        'tokio-macros-2.2.0.tar.gz::https://crates.io/api/v1/crates/tokio-macros/2.2.0/download'
        'tokio-stream-0.1.15.tar.gz::https://crates.io/api/v1/crates/tokio-stream/0.1.15/download'
        'tokio-util-0.7.11.tar.gz::https://crates.io/api/v1/crates/tokio-util/0.7.11/download'
        'toml_datetime-0.6.5.tar.gz::https://crates.io/api/v1/crates/toml_datetime/0.6.5/download'
        'toml_edit-0.21.1.tar.gz::https://crates.io/api/v1/crates/toml_edit/0.21.1/download'
        'tracing-0.1.40.tar.gz::https://crates.io/api/v1/crates/tracing/0.1.40/download'
        'tracing-attributes-0.1.27.tar.gz::https://crates.io/api/v1/crates/tracing-attributes/0.1.27/download'
        'tracing-core-0.1.32.tar.gz::https://crates.io/api/v1/crates/tracing-core/0.1.32/download'
        'tracing-subscriber-0.3.18.tar.gz::https://crates.io/api/v1/crates/tracing-subscriber/0.3.18/download'
        'typenum-1.17.0.tar.gz::https://crates.io/api/v1/crates/typenum/1.17.0/download'
        'uds_windows-1.1.0.tar.gz::https://crates.io/api/v1/crates/uds_windows/1.1.0/download'
        'unicode-ident-1.0.12.tar.gz::https://crates.io/api/v1/crates/unicode-ident/1.0.12/download'
        'version_check-0.9.4.tar.gz::https://crates.io/api/v1/crates/version_check/0.9.4/download'
        'wasi-0.11.0+wasi-snapshot-preview1.tar.gz::https://crates.io/api/v1/crates/wasi/0.11.0+wasi-snapshot-preview1/download'
        'winapi-0.3.9.tar.gz::https://crates.io/api/v1/crates/winapi/0.3.9/download'
        'winapi-i686-pc-windows-gnu-0.4.0.tar.gz::https://crates.io/api/v1/crates/winapi-i686-pc-windows-gnu/0.4.0/download'
        'winapi-x86_64-pc-windows-gnu-0.4.0.tar.gz::https://crates.io/api/v1/crates/winapi-x86_64-pc-windows-gnu/0.4.0/download'
        'windows-sys-0.48.0.tar.gz::https://crates.io/api/v1/crates/windows-sys/0.48.0/download'
        'windows-sys-0.52.0.tar.gz::https://crates.io/api/v1/crates/windows-sys/0.52.0/download'
        'windows-targets-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows-targets/0.48.5/download'
        'windows-targets-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows-targets/0.52.5/download'
        'windows_aarch64_gnullvm-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_gnullvm/0.48.5/download'
        'windows_aarch64_gnullvm-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_gnullvm/0.52.5/download'
        'windows_aarch64_msvc-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_msvc/0.48.5/download'
        'windows_aarch64_msvc-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_aarch64_msvc/0.52.5/download'
        'windows_i686_gnu-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_gnu/0.48.5/download'
        'windows_i686_gnu-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_gnu/0.52.5/download'
        'windows_i686_gnullvm-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_gnullvm/0.52.5/download'
        'windows_i686_msvc-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_msvc/0.48.5/download'
        'windows_i686_msvc-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_i686_msvc/0.52.5/download'
        'windows_x86_64_gnu-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnu/0.48.5/download'
        'windows_x86_64_gnu-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnu/0.52.5/download'
        'windows_x86_64_gnullvm-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnullvm/0.48.5/download'
        'windows_x86_64_gnullvm-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_gnullvm/0.52.5/download'
        'windows_x86_64_msvc-0.48.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_msvc/0.48.5/download'
        'windows_x86_64_msvc-0.52.5.tar.gz::https://crates.io/api/v1/crates/windows_x86_64_msvc/0.52.5/download'
        'winnow-0.5.40.tar.gz::https://crates.io/api/v1/crates/winnow/0.5.40/download'
        'xdg-home-1.1.0.tar.gz::https://crates.io/api/v1/crates/xdg-home/1.1.0/download'
        'zbus-4.2.1.tar.gz::https://crates.io/api/v1/crates/zbus/4.2.1/download'
        'zbus_macros-4.2.1.tar.gz::https://crates.io/api/v1/crates/zbus_macros/4.2.1/download'
        'zbus_names-3.0.0.tar.gz::https://crates.io/api/v1/crates/zbus_names/3.0.0/download'
        'zbus_xml-4.0.0.tar.gz::https://crates.io/api/v1/crates/zbus_xml/4.0.0/download'
        'zvariant-4.1.0.tar.gz::https://crates.io/api/v1/crates/zvariant/4.1.0/download'
        'zvariant_derive-4.1.0.tar.gz::https://crates.io/api/v1/crates/zvariant_derive/4.1.0/download'
        'zvariant_utils-1.1.1.tar.gz::https://crates.io/api/v1/crates/zvariant_utils/1.1.1/download')
sha256sums=('SKIP'
            '3459c2555f78c3b167063164b572970c760b60a95dc4146189fb854281bae9ff'
            '8a30b2e23b9e17a9f90641c7ab1549cd9b44f296d3ccbf309d2863cfe398a0cb'
            'f26201604c87b1e01bd3d98f8d5d9a8fcbb815e8cedb41ffccbeb4bf593a35fe'
            '038dfcf04a5feb68e9c60b21c9625a54c2c0616e79b72b0fd87075a056ae1d1b'
            '25bdb32cbbdce2b519a9cd7df3a678443100e265d5e25ca763b7572a5104f5f3'
            '258b52a1aa741b9f09783b2d86cf0aeeb617bbf847f6933340a39644227acbdb'
            '9f2776ead772134d55b62dd45e59a79e21612d85d0af729b8b7d3967d601a62a'
            'dcccb0f599cfa2f8ace422d3555572f47424da5648a4382a9dd0310ff8210884'
            'd034b430882f8381900d3fe6f0aaa3ad94f2cb4ac519b429692a1bc2dda4ae7b'
            'a53fc6301894e04a92cb2584fedde80cb25ba8e02d9dc39d4a87d036e22f397d'
            '3b43422f69d8ff38f95f1b2bb76517c91589a924d1559a0e935d7c8ce0274c11'
            'afe66191c335039c7bb78f99dc7520b0cbb166b3a1cb33a03f53d8a1c6f2afda'
            '8b75356056920673b02621b35afd0f7dda9306d03c79a30f5c56c44cf256e3de'
            'c6fa2087f2753a7da8cc1c0dbfcf89579dd57458e36769de5ac750b4671737ca'
            '1505bd5d3d116872e7271a6d4e16d81d0c8570876c8de68093a09ac269d8aac0'
            '0c4b4d0bd25bd0b74681c0ad21497610ce1b7c91b1022cd21c80c6fbdd9476b0'
            '26b05800d2e817c8b3b4b54abd461726265fa9789ae34330622f2db9ee696f9d'
            'bef38d45163c2f1dde094a7dfd33ccf595c92905c8f8f4fdc18d06fb1037718a'
            'cf4b9d6a944f767f8e5e0db018570623c85f3d925ac718db4e06d0187adb21c1'
            '3078c7629b62d3f0439517fa394996acacc5cbc91c5a20d8c658e77abd503a71'
            '495f7104e962b7356f0aeb34247aca1fe7d2e783b346582db7f2904cb5717e88'
            '514de17de45fdb8dc022b1a7975556c53c86f9f0aa5f534b98977b171857c2c9'
            '099a5357d84c4c61eb35fc8eafa9a79a902c2f76911e5747ced4e032edd8d9b4'
            'baf1de4339761588bc0619e3cbc0120ee582ebb74b53b4efbf79117bd2da40fd'
            'fd16c4719339c4530435d38e511904438d07cce7950afa3718a84ac36c10e89e'
            '90bc066a67923782aa8515dbaea16946c5bcc5addbd668bb80af688e53e548a0'
            'ae129e2e766ae0ec03484e609954119f123cc1fe650337e155d03b022f24f7b4'
            '528131438037fd55894f62d6e9f068b8f45ac57ffa77517819645d10aed04f64'
            '98cc8fbded0c607b7ba9dd60cd98df59af97e84d24e49c8557331cfc26d301ce'
            '4ca0197aee26d1ae37445ee532fefce43251d24cc7c166799f4d46817f1d3973'
            '53fe5e26ff1b7aef8bca9c6080520cfb8d9333c7568e1829cef191a9723e5504'
            '248e3bacc7dc6baa3b21e405ee045c3047101a49145e7e9eca583ab4c2ca5345'
            '1bfb12502f3fc46cca1bb51ac28df9d618d813cdc3d2f25b9fe775a34af26bb3'
            '9ed9a281f7bc9b7576e61468ba615a66a5c8cfdff42420a70aa82701a3b1e292'
            'a47c1c47d2f5964e29c61246e81db715514cd532db6b5116a25ea3c03d6780a2'
            'a3d8a32ae18130a3c84dd492d4215c3d913c3b07c6b63c2eb3eb7ff1101ab7bf'
            '3278c9d5fb675e0a51dabcf4c0d355f692b064171535ba72361be1528a9d8e8d'
            '5c785274071b1b420972453b306eeca06acf4633829db4223b58a2a8c5953bc4'
            '5443807d6dff69373d433ab9ef5378ad8df50ca6298caf15de6e52e24aaf54d5'
            '534c5cf6194dfab3db3242765c03bbe257cf92f22b38f6bc0c58d59108a820ba'
            '67b215c49b2b248c855fb73579eb1f4f26c38ffdc12973e20e07b91d78d5646e'
            '6d9944b8ca13534cdfb2800775f8dd4902ff3fc75a50101466decadfdf322a24'
            '958e4d70b6d5e81971bebec42271ec641e7ff4e170a6fa605f2b8a8b65cb97d3'
            '0f214dc438f977e6d4e3500aaa277f5ad94ca83fbbd9b1a15713ce2344ccc5a1'
            '9fc0510504f03c51ada170672ac806f1f105a88aa97a5281117e1ddc3368e51a'
            'dfc6580bb841c5a68e9ef15c77ccc837b40a7504914d52e47b8b0e9bbda25a1d'
            'a44623e20b9681a318efdd71c299b6b222ed6f231972bfe2f224ebad6311f0c1'
            '52527eb5074e35e9339c6b4e8d12600c7128b68fb25dcb9fa9dec18f7c25f3a5'
            '9fb8e00e87438d937621c1c6269e53f536c14d3fbd6a042bb24879e57d474fb5'
            '38d84fa142264698cdce1a9f9172cf383a0c82de1bddcf3092901442c4097004'
            '3d6401deb83407ab3da39eba7e33987a73c3df0c82b4bb5813ee871c19c41d48'
            '85649ca51fd72272d7821adaf274ad91c288277713d9c18820d8499a7ff69e9a'
            'c4567c8db10ae91089c99af84c68c38da3ec2f087c3f82960bcdbf3656b6f4d7'
            '4271d37baee1b8c7e4b708028c57d816cf9d2434acb33a549475f78c181f6253'
            'e5274423e17b7c9fc20b6e7e208532f9b19825d82dfd615708b70edd83df41f1'
            '2304e00983f87ffb38b55b444b5e3b60a884b5d30c0fca7d82fe33449bbe55ea'
            'd231dfb89cfffdbc30e7fc41579ed6066ad03abda9e567ccafae602b97ec5024'
            '7f24254aa9a54b5c858eaee2f5bccdb46aaf0e486a595ed5fd8f86ba55232a70'
            '168fb715dda47215e360912c096649d23d58bf392ac62f73919e831745e40f26'
            'fdd168d97690d0b8c412d6b6c10360277f4d7ee495c5d0d5d5fe0854923255cc'
            'e05c02b5e89bff3b946cedeca278abc628fe811e604f027c45a8aa3cf793d0eb'
            'ba291022dbbd398a455acf126c1e341954079855bc60dfdda641363bd6922569'
            'e2abad23fbc42b3700f2f279844dc832adb2b2eb069b2df918f455c4e18cc646'
            'ae743338b92ff9146ce83992f766a31066a91a8c84a45e0e9f21e7cf6de6d346'
            '01cda141df6706de531b6c46c3a33ecca755538219bd484262fa09410c13539c'
            '6c8640c5d730cb13ebd907d8d04b52f55ac9a2eec55b440c8892f40d56c76c1d'
            '488016bfae457b036d996092f6cb448677611ce4449e970ceaf42695203f218a'
            '9d811f3e15f28568be3407c8e7fdb6514c1cda3cb30683f15b6a1a1dc4ea14a7'
            'a4a650543ca06a924e8b371db273b2756685faae30f8487da1b56505a8f78b0c'
            'ab2156c4fce2f8df6c499cc1c763e4394b7482525bf2a9701c9d79d215f519e4'
            '4161fcb6d602d4d2081af7c3a45852d875a03dd337a6bfdd6e06407b61342a43'
            'a6a622008b6e321afc04970976f62ee297fdbaa6f95318ca343e3eebb9648441'
            '3fdb12b2476b595f9358c5161aa467c2438859caa136dec86c26fdd2efe17b92'
            '9aa2b01e1d916879f73a53d01d1d6cee68adbb31d6d9177a8cfce093cced1d50'
            'bb813b8af86854136c6922af0598d719255ecb2179515e6e7730d468f05c9cae'
            'bda66fc9667c18cb2758a2ac84d1167245054bcf85d5d1aaa6923f45801bdd02'
            '8b870d8c151b6f2fb93e84a13146138f05d02ed11c7e7c54f8826aaaf7c9f184'
            '464db0c665917b13ebb5d453ccdec4add5658ee1adc7affc7677615356a8afaf'
            '645493cf344456ef24219d02a768cf1fb92ddf8c92161679ae3d91b91a637be3'
            '5b40af805b3121feab8a3c29f04d8ad262fa8e0561883e7653e024ae4479e6de'
            '6d37c51ca738a55da99dc0c4a34860fd675453b8b36209178c2249bb13651284'
            '8ad3d49ab951a01fbaafe34f2ec74122942fe18a3f9814c3268f1bb72042131b'
            'eff6510e86862b57b210fd8cbe8ed3f0d7d600b9c2863cd4549a2e033c66e956'
            '0fa76aaf39101c457836aec0ce2316dbdc3ab723cdda1c6bd4e6ad4208acaca7'
            '34af8d1a0e25924bc5b7c43c079c942339d8f0a8b57c39049bef581b46327404'
            'e6c10a63a0fa32252be49d21e7709d4d4baf8d231c2dbce1eaa8141b9b127d88'
            'ec0be4795e2f6a28069bec0b5ff3e2ac9bafc99e6a9a7dc3547996c5c816922c'
            '719b953e2095829ee67db738b3bfa9fa368c94900df327b3f07fe6e794d2fe1f'
            '70dc5ec042f7a43c4a73241207cecc9873a06d45debb38b329f8541d85c2730f'
            '780f1cebed1629e4753a1a38a3c72d30b97ec044f0aef68cb26650a3c5cf363c'
            'c5e405930b9796f1c00bee880d03fc7e0bb4b9a11afc776885ffe84320da2865'
            '6c64451ba24fc7a6a2d60fc75dd9c83c90903b19028d4eff35e88fc1e86564e9'
            'e3bf829a2d51ab4a5ddf1352d8470c140cadc8301b2ae1789db023f01cedd6ba'
            'f40ca3c46823713e0d4209592e8d6e826aa57e928f09752619fc696c499637f6'
            'a9e9e0b4211b72e7b8b6e85c807d36c212bdb33ea8587f7569562a84df5465b1'
            '8f92a496fb766b417c996b9c5e57daf2f7ad3b0bebe1ccfca4856390e3d3bb67'
            'ce305eb0b4296696835b71df73eb912e0f1ffd2556a501fcede6e0c50349191c'
            'a2eb9349b6444b326872e140eb1cf5e7c522154d69e7a0ffb0fb81c06b37543f'
            '72b64191b275b66ffe2469e8af2c1cfe3bafa67b529ead792a6d0160888b4237'
            'bf5be731623ca1a1fb7d8be6f261a3be6d3e2337b8a1f97be944d020c8fcb704'
            '85b77fafb263dd9d05cbeac119526425676db3784113aa9295c88498cbf8bff1'
            '8b9ef9bad013ada3808854ceac7b46812a6465ba368859a37e2100283d2d719c'
            '1adbebffeca75fcfd058afa480fb6c0b81e165a0323f9c9d39c9697e37c46787'
            '5b8a1e28f2deaa14e508979454cb3a223b10b938b45af148bc0986de36f1923b'
            '267ac89e0bec6e691e5813911606935d77c476ff49024f98abcea3e7b15e37af'
            '9cf6b47b3771c49ac75ad09a6162f53ad4b8088b76ac60e8ec1455b31a189fe1'
            '3550f4e9685620ac18a50ed434eb3aec30db8ba93b0287467bca5826ea25baf1'
            '6a8534fd7f78b5405e860340ad6575217ce99f38d4d5c8f2442cb5ecb50090e1'
            'c3523ab5a71916ccf420eebdf5521fcef02141234bbc0b8a49f2fdc4544364ef'
            '34704c8d6ebcbc939824180af020566b01a7c01f80641264eba0999f6c2b6be7'
            'c06d3da6113f116aaee68e4d601191614c9053067f9ab7f6edbcb161237daa54'
            'ad0f048c97dbd9faa9b7df56362b8ebcaa52adb06b498c050d2f4e32f90a7a8b'
            '42ff0bf0c66b8238c6f3b578df37d0b7848e55df8577b3f74f92a69acceeb825'
            '89daebc3e6fd160ac4aa9fc8b3bf71e1f74fbf92367ae71fb83a037e8bf164b9'
            '3354b9ac3fae1ff6755cb6db53683adb661634f67557942dea4facebec0fee4b'
            '49874b5167b65d7193b8aba1567f5c7d93d001cafc34600cee003eda787e483f'
            '9c8d87e72b64a3b4db28d11ce29237c246188f4f51057d65a7eab63b7987e423'
            '5c839a674fcd7a98952e593242ea400abe93992746761e38641405d28b00f419'
            'ac3b87c63620426dd9b991e5ce0329eff545bccbbb34f3be09ff6fb6ab51b7b6'
            '712e227841d057c1ee1cd2fb22fa7e5a5461ae8e48fa2ca79ec42cfc1931183f'
            '677d2418bec65e3338edb076e806bc1ec15693c5d0104683f2efe857f61056a9'
            '282be5f36a8ce781fad8c8ae18fa3f9beff57ec1b52cb3de0789201425d9a33d'
            '9a2fa6e2155d7247be68c096456083145c183cbbbc2764150dda45a87197940c'
            '6f0713a46559409d202e70e28227288446bf7841d3211583a4b53e3f6d96e7eb'
            '2b38e32f0abccf9987a4e3079dfb67dcd799fb61361e53e2882c3cbaf0d905d8'
            '7088eed71e8b8dda258ecc8bac5fb1153c5cffaf2578fc8ff5d61e23578d3263'
            'dc35310971f3b2dbbf3f0690a219f40e2d9afcf64f9ab7cc1be722937c26b4bc'
            '9985fd1504e250c615ca5f281c3f7a6da76213ebd5ccc9561496568a2752afb6'
            'a75915e7def60c94dcef72200b9a8e58e5091744960da64ec734a6c6e9b3743e'
            '88ba073cf16d5372720ec942a8ccbf61626074c6d4dd2e745299726ce8b89670'
            '87f4261229030a858f36b459e748ae97545d6f1ec60e5e0d6a3d32e0dc232ee9'
            '8f55c233f70c4b27f66c523580f78f1004e8b5a8b659e05a4eb49d4166cca406'
            'db3c2bf3d13d5b658be73463284eaf12830ac9a26a90c717b7f771dfe97487bf'
            '53d40abd2583d23e4718fddf1ebec84dbff8381c07cae67ff7768bbf19c6718e'
            '4e4246f76bdeff09eb48875a0fd3e2af6aada79d409d33011886d3e1581517d9'
            '0b7b52767868a23d5bab768e390dc5f5c55825b6d30b86c844ff2dc7414044cc'
            '852298e482cd67c356ddd9570386e2862b5673c85bd5f88df9ab6802b334c596'
            'ed94fce61571a4006852b7389a063ab983c02eb1bb37b47f8272ce92d06d9538'
            'bec47e5bfd1bff0eeaf6d8b485cc1074891a197ab4225d504cb7a1ab88b02bf0'
            'f593a95398737aeed53e489c785df13f3618e41dbcd6718c6addbf1395aa6876'
            '21e5a325c3cb8398ad6cf859c1135b25dd29e186679cf2da7581d9679f63b38e'
            'e5915716dff34abef1351d2b10305b019c8ef33dcf6c72d31a6e227d5d9d7a21'
            '66fceb36d0c1c4a6b98f3ce40f410e64e5a134707ed71892e1b178abc4c695d4'
            '4b9b1fef7d021261cc16cba64c351d291b715febe0fa10dc3a443ac5a5022e6c'
            'ab3f374552b954f6abb4bd6ce979e6c9b38fb9d0cd7cc68a7d796e70c9f3a233'
            '877ef94e5e82b231d2a309c531f191a8152baba8241a7939ee04bd76b0171308'
            'b7ca98581cc6a8120789d8f1f0997e9053837d6aa5346cbb43454d7121be6e39'
            '75fa7291bdd68cd13c4f97cc9d78cbf16d96305856dfc7ac942aeff4c2de7d5a')
replaces=('ds-inhibit')

prepare() {
	export RUSTUP_TOOLCHAIN=stable
	cd "$srcdir"

	holo-vendor-rust-sources -o vendored -L "$pkgname-$pkgver/Cargo.lock" *.tar.gz

	cd "$pkgname-$pkgver"

	mkdir -pv .cargo

	cat << EOF >> .cargo/config.toml
	[source."crates-io"]
	replace-with = "vendored-sources"

	[source.vendored-sources]
	directory = "${srcdir}/vendored"
EOF

    patch -p1 < "$srcdir/disable-split-lock-warn.patch"
}

build() {
	cd "$pkgname-$pkgver"
	cargo build -r
}

package () {
	cd "$pkgname-$pkgver"
	install -d -m0755 "$pkgdir/usr/share/dbus-1/services/"
	install -d -m0755 "$pkgdir/usr/share/dbus-1/system-services/"
	install -d -m0755 "$pkgdir/usr/share/dbus-1/system.d/"
	install -d -m0755 "$pkgdir/usr/lib/systemd/system/"
	install -d -m0755 "$pkgdir/usr/lib/systemd/user/gamescope-session.service.wants/"

	install -D -m755 "target/release/steamos-manager" "$pkgdir/usr/lib/steamos-manager"
	install -D -m755 "target/release/steamosctl" "$pkgdir/usr/bin/steamosctl"
	install -D -m644 LICENSE "$pkgdir/usr/share/licenses/$pkgname"

	install -m644 "data/system/com.steampowered.SteamOSManager1.service" "$pkgdir/usr/share/dbus-1/system-services/"
	install -m644 "data/system/com.steampowered.SteamOSManager1.conf" "$pkgdir/usr/share/dbus-1/system.d/"
	install -m644 "data/system/steamos-manager.service" "$pkgdir/usr/lib/systemd/system/"

	install -m644 "data/user/com.steampowered.SteamOSManager1.service" "$pkgdir/usr/share/dbus-1/services/"
	install -m644 "data/user/steamos-manager.service" "$pkgdir/usr/lib/systemd/user/"

	ln -s ../steamos-manager.service "$pkgdir/usr/lib/systemd/user/gamescope-session.service.wants/"
}

check() {
	cd "$pkgname-$pkgver"
	dbus-run-session cargo test
}
