From d1acc803316db070be493f36f30a96edf70d14a3 Mon Sep 17 00:00:00 2001
From: Denis Kenzior <denkenz@gmail.com>
Date: Fri, 21 Oct 2022 13:41:42 -0500
Subject: [PATCH 24/27] netdev: Support more IGTK cipher suites

---
 src/netdev.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/netdev.c b/src/netdev.c
index 7b894860..636c02de 100644
--- a/src/netdev.c
+++ b/src/netdev.c
@@ -1674,7 +1674,7 @@ static void netdev_set_igtk(struct handshake_state *hs, uint16_t key_index,
 {
 	struct netdev_handshake_state *nhs =
 		l_container_of(hs, struct netdev_handshake_state, super);
-	uint8_t igtk_buf[16];
+	uint8_t igtk_buf[32];
 	struct netdev *netdev = nhs->netdev;
 	struct l_genl_msg *msg;
 
@@ -1690,7 +1690,10 @@ static void netdev_set_igtk(struct handshake_state *hs, uint16_t key_index,
 
 	switch (cipher) {
 	case CRYPTO_CIPHER_BIP_CMAC:
-		memcpy(igtk_buf, igtk, 16);
+	case CRYPTO_CIPHER_BIP_GMAC:
+	case CRYPTO_CIPHER_BIP_GMAC_256:
+	case CRYPTO_CIPHER_BIP_CMAC_256:
+		memcpy(igtk_buf, igtk, igtk_len);
 		break;
 	default:
 		l_error("Unexpected cipher: %x", cipher);
-- 
2.38.1

